<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Email Signature Field Replacer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./dist/output.css" />
</head>
<body class="bg-gray-100 text-gray-900">
  <header class="flex h-[68px] items-center px-6 bg-white border-b border-gray-200">
    <img class="h-9 w-auto" src="https://cdn.prod.website-files.com/6826f1bc2fc92556aa2497cc/69392412e6b34a38bb174dc6_Signature%20Tool%20Logo.png" alt="Signature Tool logo" />
  </header>
  <section class="bg-[#FAF7F2] px-4 py-14 sm:py-16">
    <div class="max-w-4xl mx-auto text-center">
      <h1 class="hivory-h1 mb-4 text-slate-900">Revenue-first analytics</h1>
      <p class="hivory-paragraph-large text-gray-600 max-w-3xl mx-auto">
        Discover which marketing channels bring customers so you can grow your business, fast.
      </p>

      <div class="max-w-2xl mx-auto mt-10 flex flex-col gap-3 sm:flex-row sm:items-stretch">
        <div class="flex items-center gap-3 bg-white border border-gray-200 rounded-2xl px-4 py-3 shadow-sm w-full">
          <span class="text-gray-400 text-xl">üåê</span>
          <input
            type="text"
            placeholder="Paste your HTML signature"
            class="flex-1 text-lg text-gray-700 placeholder:text-gray-400 focus:outline-none"
          />
        </div>
        <button
          class="bg-[#e5683c] text-white text-lg font-semibold rounded-2xl px-6 py-3 shadow-[0_10px_30px_rgba(229,104,60,0.35)] hover:bg-[#da5d32] transition"
        >
          Add my signature ‚Üí
        </button>
      </div>

      <div class="mt-4 text-gray-600 text-base">Free to use. No card required.</div>

      <div class="mt-6 flex flex-col items-center gap-3">
        <div class="flex -space-x-3">
          <img class="w-10 h-10 rounded-full border-2 border-[#FAF7F2]" src="https://i.pravatar.cc/80?img=12" alt="user 1">
          <img class="w-10 h-10 rounded-full border-2 border-[#FAF7F2]" src="https://i.pravatar.cc/80?img=25" alt="user 2">
          <img class="w-10 h-10 rounded-full border-2 border-[#FAF7F2]" src="https://i.pravatar.cc/80?img=30" alt="user 3">
          <img class="w-10 h-10 rounded-full border-2 border-[#FAF7F2]" src="https://i.pravatar.cc/80?img=5" alt="user 4">
          <img class="w-10 h-10 rounded-full border-2 border-[#FAF7F2]" src="https://i.pravatar.cc/80?img=18" alt="user 5">
          <img class="w-10 h-10 rounded-full border-2 border-[#FAF7F2]" src="https://i.pravatar.cc/80?img=44" alt="user 6">
          <img class="w-10 h-10 rounded-full border-2 border-[#FAF7F2]" src="https://i.pravatar.cc/80?img=36" alt="user 7">
          <img class="w-10 h-10 rounded-full border-2 border-[#FAF7F2]" src="https://i.pravatar.cc/80?img=9" alt="user 8">
        </div>
        <div class="text-gray-700 text-base">
          Loved by <span class="font-semibold">10,687</span> users
        </div>
      </div>
    </div>
  </section>

  <div class="max-w-5xl mx-auto mt-6 bg-white rounded-xl shadow-lg p-5 sm:p-6">
    <h2 class="hivory-h3 mb-1">Email Signature Field Replacer</h2>
    <p class="hivory-paragraph-small text-gray-600 mb-4">Paste your HTML email signature, detect fields (name, title, email, phone), then generate a new version with updated details.</p>

    <div class="mb-6">
      <div class="hivory-h5 mb-2">1. Paste your HTML signature</div>
      <label for="signatureInput" class="hivory-paragraph-small font-semibold block mb-1">Signature HTML</label>
      <textarea id="signatureInput" class="w-full min-h-[160px] rounded-lg border border-gray-300 px-3 py-2 font-mono text-sm resize-y focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Paste your HTML email signature here..."></textarea>

      <div class="flex flex-wrap gap-2 mt-3">
        <button id="detectBtn" class="inline-flex items-center gap-1 rounded-full px-4 py-2 text-sm font-semibold bg-slate-900 text-white hover:bg-slate-800 disabled:opacity-60 disabled:cursor-not-allowed">Find fields</button>
        <button id="clearBtn" class="inline-flex items-center gap-1 rounded-full px-4 py-2 text-sm font-semibold bg-gray-200 text-gray-900 hover:bg-gray-300 disabled:opacity-60 disabled:cursor-not-allowed" type="button">Clear</button>
      </div>
      <div id="detectStatus" class="hivory-paragraph-small text-gray-500 mt-2"></div>
    </div>

    <div class="mb-6">
      <div class="flex items-center justify-between gap-2">
        <div class="hivory-h5 flex items-center">
          2. Edit the detected fields
          <span class="inline-block text-[10px] px-2 py-0.5 rounded-full bg-indigo-50 text-indigo-800 uppercase tracking-[0.03em] ml-1">Auto-detected</span>
        </div>
        <span class="hivory-paragraph-small text-gray-500">You can change the values before generating.</span>
      </div>
      <div id="fieldsContainer" class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-3"></div>
      <div id="noFieldsMsg" class="hivory-paragraph-small text-gray-500 mt-1"></div>
    </div>

    <div class="mb-2">
      <div class="hivory-h5 mb-2">3. Generate and preview updated signature</div>
      <div class="flex flex-wrap gap-2">
        <button id="generateBtn" class="inline-flex items-center gap-1 rounded-full px-4 py-2 text-sm font-semibold bg-slate-900 text-white hover:bg-slate-800 disabled:opacity-60 disabled:cursor-not-allowed" disabled>Generate</button>
        <button id="copyBtn" class="inline-flex items-center gap-1 rounded-full px-4 py-2 text-sm font-semibold bg-gray-200 text-gray-900 hover:bg-gray-300 disabled:opacity-60 disabled:cursor-not-allowed" type="button" disabled>Copy signature</button>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-[1.1fr_0.9fr] gap-4 mt-4">
        <div class="min-w-0">
          <label for="outputHtml" class="hivory-paragraph-small font-semibold block mb-1">Updated HTML</label>
          <textarea id="outputHtml" class="w-full min-h-[160px] rounded-lg border border-gray-300 px-3 py-2 font-mono text-sm resize-y focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Your updated HTML will appear here..." readonly></textarea>
          <div class="hivory-paragraph-small text-gray-500 mt-1">Copy this HTML or use the button above to copy it with rich formatting.</div>
        </div>

        <div class="min-w-0">
          <label class="hivory-paragraph-small font-semibold block mb-1">Preview</label>
          <div class="rounded-xl border border-gray-200 overflow-hidden bg-gray-50">
            <iframe id="previewFrame" title="Signature preview" class="w-full border-0 bg-white min-h-[150px]"></iframe>
          </div>
          <div class="hivory-paragraph-small text-gray-500 mt-1">
            This is how your signature will look when pasted into your email client.
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const signatureInput = document.getElementById("signatureInput");
    const detectBtn = document.getElementById("detectBtn");
    const clearBtn = document.getElementById("clearBtn");
    const generateBtn = document.getElementById("generateBtn");
    const copyBtn = document.getElementById("copyBtn");
    const fieldsContainer = document.getElementById("fieldsContainer");
    const detectStatus = document.getElementById("detectStatus");
    const outputHtml = document.getElementById("outputHtml");
    const noFieldsMsg = document.getElementById("noFieldsMsg");
    const previewFrame = document.getElementById("previewFrame");

    // Store detected fields here
    let detectedFields = [];
    let originalHtml = "";
    let lastGeneratedHtml = "";

    function resetUI() {
      fieldsContainer.innerHTML = "";
      detectStatus.textContent = "";
      outputHtml.value = "";
      noFieldsMsg.textContent = "";
      detectedFields = [];
      generateBtn.disabled = true;
      copyBtn.disabled = true;
      lastGeneratedHtml = "";
      updatePreview(""); // clear preview
    }

    clearBtn.addEventListener("click", () => {
      signatureInput.value = "";
      resetUI();
    });

    detectBtn.addEventListener("click", () => {
      const html = signatureInput.value.trim();
      resetUI();

      if (!html) {
        detectStatus.innerHTML = "<strong>Nothing to scan.</strong> Paste your signature HTML first.";
        return;
      }

      originalHtml = html;
      detectedFields = detectFieldsFromHtml(html);
      renderFields(detectedFields);

      if (detectedFields.length === 0) {
        detectStatus.innerHTML = "<strong>No obvious fields found.</strong> You can still manually replace values later by editing the HTML.";
        noFieldsMsg.textContent = "Tip: Use clear placeholder text like 'Full name', 'Job title', etc. for easier detection.";
      } else {
        detectStatus.innerHTML = `<strong>Found ${detectedFields.length} field(s).</strong> Edit the values below, then click Generate.`;
        generateBtn.disabled = false;
      }
    });

    generateBtn.addEventListener("click", () => {
      if (!originalHtml) return;

      let updatedHtml = originalHtml;

      // Read current input values & replace
      detectedFields.forEach((field) => {
        const input = document.querySelector(`input[data-field-key="${field.key}"]`);
        if (!input) return;

        const newValue = input.value || field.originalValue;
        if (!field.originalValue) return;

        // Simple global string replace
        updatedHtml = updatedHtml.split(field.originalValue).join(newValue);
      });

      lastGeneratedHtml = updatedHtml;
      outputHtml.value = updatedHtml;
      copyBtn.disabled = !updatedHtml.trim();
      updatePreview(updatedHtml);
    });

    copyBtn.addEventListener("click", async () => {
      if (!lastGeneratedHtml) return;

      const html = lastGeneratedHtml;

      // Try to use Clipboard API with text/html for rich paste
      if (navigator.clipboard && window.ClipboardItem) {
        try {
          const blob = new Blob([html], { type: "text/html" });
          const data = [new ClipboardItem({ "text/html": blob })];
          await navigator.clipboard.write(data);
          copyBtn.textContent = "Copied!";
          setTimeout(() => (copyBtn.textContent = "Copy signature"), 1200);
          return;
        } catch (err) {
          console.warn("Rich clipboard failed, falling back to text-only copy.", err);
        }
      }

      // Fallback: select the textarea and copy as text
      outputHtml.focus();
      outputHtml.select();
      try {
        document.execCommand("copy");
        copyBtn.textContent = "Copied!";
        setTimeout(() => (copyBtn.textContent = "Copy signature"), 1200);
      } catch (err) {
        console.error("Copy failed", err);
      } finally {
        window.getSelection().removeAllRanges();
      }
    });

    function renderFields(fields) {
      fieldsContainer.innerHTML = "";
      if (!fields.length) return;

      fields.forEach((field) => {
        const card = document.createElement("div");
        card.className = "rounded-lg border border-gray-200 bg-gray-50 p-3 text-sm space-y-1";
        card.innerHTML = `
          <small class="block text-xs text-gray-500">${field.label}</small>
          <input 
            type="text" 
            data-field-key="${field.key}" 
            class="w-full text-sm px-3 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" 
            value="${escapeHtml(field.suggestedValue || field.originalValue || "")}" 
          />
          <small class="block text-xs text-gray-500">Original: <code class="font-mono text-[11px]">${escapeHtml(field.originalValue || "")}</code></small>
        `;
        fieldsContainer.appendChild(card);
      });
    }

    // Basic heuristics to detect common fields
    function detectFieldsFromHtml(html) {
      const fields = [];

      // 1) Email
      const emailRegex = /[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/i;
      const emailMatch = html.match(emailRegex);
      if (emailMatch) {
        fields.push({
          key: "email",
          label: "Email",
          originalValue: emailMatch[0],
          suggestedValue: emailMatch[0]
        });
      }

      // 2) Phone number (very loose pattern)
      const phoneRegex = /(\+?\d[\d\s().-]{7,}\d)/;
      const phoneMatch = html.match(phoneRegex);
      if (phoneMatch) {
        fields.push({
          key: "phone",
          label: "Phone",
          originalValue: phoneMatch[0].trim(),
          suggestedValue: phoneMatch[0].trim()
        });
      }

      // 3) Parse as HTML to get text nodes
      const wrapperHtml = "<div>" + html + "</div>";
      let textNodes = [];
      try {
        const parser = new DOMParser();
        const doc = parser.parseFromString(wrapperHtml, "text/html");
        textNodes = getTextNodes(doc.body)
          .map((n) => n.nodeValue.trim())
          .filter((t) => t.length > 0);
      } catch (e) {
        // Fallback: simple split on tags
        textNodes = html
          .replace(/<[^>]+>/g, " ")
          .split(/\s{2,}/)
          .map((t) => t.trim())
          .filter((t) => t);
      }

      // Remove email & phone from text candidates
      const cleaned = textNodes.filter((t) => {
        return !emailRegex.test(t) && !phoneRegex.test(t);
      });

      // If placeholders exist, prioritise those
      const PLACEHOLDER_NAME = "Full name";
      const PLACEHOLDER_TITLE = "This is a title";

      if (html.includes(PLACEHOLDER_NAME)) {
        fields.push({
          key: "fullName",
          label: "Full name",
          originalValue: PLACEHOLDER_NAME,
          suggestedValue: ""
        });
      }

      if (html.includes(PLACEHOLDER_TITLE)) {
        fields.push({
          key: "title",
          label: "Job title",
          originalValue: PLACEHOLDER_TITLE,
          suggestedValue: ""
        });
      }

      // Fallback: first 1‚Äì2 non-empty text nodes as name/title
      if (!fields.some((f) => f.key === "fullName") && cleaned[0]) {
        fields.push({
          key: "fullName",
          label: "Full name",
          originalValue: cleaned[0],
          suggestedValue: cleaned[0]
        });
      }
      if (!fields.some((f) => f.key === "title") && cleaned[1]) {
        fields.push({
          key: "title",
          label: "Job title",
          originalValue: cleaned[1],
          suggestedValue: cleaned[1]
        });
      }

      // Deduplicate by originalValue
      const seen = new Set();
      return fields.filter((f) => {
        if (!f.originalValue) return false;
        const key = f.label + "::" + f.originalValue;
        if (seen.has(key)) return false;
        seen.add(key);
        return true;
      });
    }

    function getTextNodes(node) {
      const textNodes = [];
      function walk(n) {
        if (n.nodeType === Node.TEXT_NODE) {
          textNodes.push(n);
        } else {
          n.childNodes.forEach(walk);
        }
      }
      walk(node);
      return textNodes;
    }

    function escapeHtml(str) {
      return String(str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;");
    }

    // Render HTML into iframe for safe-ish preview
    function updatePreview(html) {
      const doc = previewFrame.contentDocument || previewFrame.contentWindow.document;
      doc.open();
      if (!html) {
        doc.write("<!doctype html><html><head><meta charset='utf-8'></head><body style='font-family:system-ui; font-size:12px; color:#9ca3af; display:flex; align-items:center; justify-content:center; height:120px;'>Signature preview will appear here after you generate it.</body></html>");
      } else {
        doc.write(
          "<!doctype html><html><head><meta charset='utf-8'></head><body>" +
          html +
          "</body></html>"
        );
      }
      doc.close();

      // Adjust iframe height to content (roughly)
      setTimeout(() => {
        try {
          const body = doc.body;
          const height = body.scrollHeight || 150;
          previewFrame.style.height = Math.min(Math.max(height, 150), 400) + "px";
        } catch (e) {
          // ignore
        }
      }, 50);
    }

    // Initialize empty preview on load
    updatePreview("");
  </script>
</body>
</html>
